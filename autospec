local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local LegendaryFolder = ReplicatedStorage.RarityFolders.Specializations:WaitForChild("Legendary")
local SpinRemote = ReplicatedStorage.RemoteEvents:WaitForChild("SpinRemote")
local LevelingRemote = ReplicatedStorage.RemoteEvents:WaitForChild("LevelingRemote")

-- Turbo
local TURBO_MODE = true
local NORMAL_DELAY = 0.5
local TURBO_DELAY = 0.05
local CHECK_INTERVAL = 0.2

-- Auto level
_G.autoLevel = false
spawn(function()
    while wait(0.1) do
        if _G.autoLevel then
            for i = 1, 100 do
                LevelingRemote:FireServer()
            end
        end
    end
end)

local colorBG = Color3.fromRGB(30, 30, 30)
local colorAccent = Color3.fromRGB(255, 120, 0)
local colorText = Color3.fromRGB(255, 255, 255)
local colorSecondary = Color3.fromRGB(50, 50, 50)
local colorGreen = Color3.fromRGB(0, 180, 80)
local colorSelected = Color3.fromRGB(255, 80, 0)
local colorTurbo = Color3.fromRGB(255, 60, 60)
local colorToggleOn = Color3.fromRGB(0, 150, 0)
local colorToggleOff = Color3.fromRGB(80, 80, 80)

local screenGui = Instance.new("ScreenGui", PlayerGui)
screenGui.Name = "AutoSpinTurboProGUI"
screenGui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 260, 0, 320)
mainFrame.Position = UDim2.new(0.5, -130, 0.5, -160)
mainFrame.BackgroundColor3 = colorBG
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner", mainFrame)
corner.CornerRadius = UDim.new(0, 12)

local stroke = Instance.new("UIStroke", mainFrame)
stroke.Color = colorAccent
stroke.Thickness = 2

-- Ui tat
local toggleBtn = Instance.new("TextButton", screenGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 40)
toggleBtn.Position = UDim2.new(0, 10, 0, 10)
toggleBtn.Text = "TẮT Ở ĐÂY🫵"
toggleBtn.BackgroundColor3 = colorAccent
toggleBtn.TextColor3 = colorText
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn)

toggleBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, -20, 0, 30)
title.Position = UDim2.new(0, 10, 0, 10)
title.Text = "QUAY SPEC CHO AE CUT TAY V1"
title.TextColor3 = colorAccent
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.BackgroundTransparency = 1

-- Dropdown
local dropdown = Instance.new("TextButton", mainFrame)
dropdown.Size = UDim2.new(0.9, 0, 0, 30)
dropdown.Position = UDim2.new(0.05, 0, 0.15, 0)
dropdown.BackgroundColor3 = colorSecondary
dropdown.Text = "CHỌN SPEC ĐI..."
dropdown.TextColor3 = Color3.fromRGB(180, 180, 180)
dropdown.Font = Enum.Font.GothamBold
dropdown.TextSize = 14
Instance.new("UICorner", dropdown)

local dropdownList = Instance.new("ScrollingFrame", mainFrame)
dropdownList.Size = UDim2.new(0.9, 0, 0, 0)
dropdownList.Position = UDim2.new(0.05, 0, 0.25, 0)
dropdownList.BackgroundColor3 = colorBG
dropdownList.Visible = false
dropdownList.ScrollBarThickness = 5
Instance.new("UICorner", dropdownList)

local listLayout = Instance.new("UIListLayout", dropdownList)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Padding = UDim.new(0, 5)

local selectedItems = {}
local isSpinning = false
local stopSpinning = false
local spinCoroutine = nil

local function hasSpecificItem(itemName)
    local item = LegendaryFolder:FindFirstChild(itemName)
    return item and item:IsA("ObjectValue") and item.Value ~= nil
end

local function refreshDropdown()
    for _, child in pairs(dropdownList:GetChildren()) do
        if child:IsA("TextButton") then child:Destroy() end
    end

    for _, item in ipairs(LegendaryFolder:GetChildren()) do
        local btn = Instance.new("TextButton", dropdownList)
        btn.Size = UDim2.new(1, 0, 0, 30)
        btn.Text = item.Name
        btn.TextColor3 = colorText
        btn.BackgroundColor3 = selectedItems[item.Name] and colorGreen or colorSecondary
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 14
        Instance.new("UICorner", btn)

        btn.MouseButton1Click:Connect(function()
            selectedItems[item.Name] = not selectedItems[item.Name]
            btn.BackgroundColor3 = selectedItems[item.Name] and colorGreen or colorSecondary

            local count = 0
            for _ in pairs(selectedItems) do count += 1 end
            dropdown.Text = count > 0 and ("Selected: "..count.." items") or "Select target items..."
        end)
    end
end

refreshDropdown()

dropdown.MouseButton1Click:Connect(function()
    dropdownList.Visible = not dropdownList.Visible
    local count = #LegendaryFolder:GetChildren()
    dropdownList.Size = dropdownList.Visible and UDim2.new(0.9, 0, 0, math.min(160, count * 35)) or UDim2.new(0.9, 0, 0, 0)
    dropdownList.CanvasSize = UDim2.new(0, 0, 0, count * 35)
end)

-- Turbo spin
local function turboSpin()
    local lastCheck = 0

    while isSpinning and not stopSpinning do
        local now = tick()
        SpinRemote:FireServer(1)

        if now - lastCheck >= CHECK_INTERVAL then
            for itemName in pairs(selectedItems) do
                if hasSpecificItem(itemName) then
                    return true
                end
            end
            lastCheck = now
        end

        task.wait(TURBO_MODE and TURBO_DELAY or NORMAL_DELAY)
    end
    return false
end

-- bắt đầu
local startBtn = Instance.new("TextButton", mainFrame)
startBtn.Size = UDim2.new(0.9, 0, 0, 35)
startBtn.Position = UDim2.new(0.05, 0, 0.55, 0)
startBtn.Text = "🚀 START TURBO SPIN"
startBtn.BackgroundColor3 = colorTurbo
startBtn.TextColor3 = colorText
startBtn.Font = Enum.Font.GothamBold
startBtn.TextSize = 14
Instance.new("UICorner", startBtn)

-- dừng
local stopBtn = Instance.new("TextButton", mainFrame)
stopBtn.Size = UDim2.new(0.9, 0, 0, 35)
stopBtn.Position = UDim2.new(0.05, 0, 0.65, 0)
stopBtn.Text = "🛑 STOP SPINNING"
stopBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
stopBtn.TextColor3 = colorText
stopBtn.Font = Enum.Font.GothamBold
stopBtn.TextSize = 14
Instance.new("UICorner", stopBtn)

stopBtn.MouseButton1Click:Connect(function()
    stopSpinning = true
    isSpinning = false
    if spinCoroutine then
        coroutine.close(spinCoroutine)
        spinCoroutine = nil
    end
    startBtn.Text = "🚀 START TURBO SPIN"
end)

startBtn.MouseButton1Click:Connect(function()
    if isSpinning then return end
    if not next(selectedItems) then
        warn("No items selected!")
        return
    end

    isSpinning = true
    stopSpinning = false
    startBtn.Text = "⚡ SPINNING..."

    spinCoroutine = coroutine.create(function()
        local success = turboSpin()

        isSpinning = false
        startBtn.Text = "🚀 START TURBO SPIN"

        if success then
            for i = 1, 3 do
                startBtn.BackgroundColor3 = colorGreen
                task.wait(0.1)
                startBtn.BackgroundColor3 = colorTurbo
                task.wait(0.1)
            end
        end
    end)

    coroutine.resume(spinCoroutine)
end)

local turboToggle = Instance.new("TextButton", mainFrame)
turboToggle.Size = UDim2.new(0.45, -5, 0, 25)
turboToggle.Position = UDim2.new(0.05, 0, 0.86, 0)
turboToggle.Text = TURBO_MODE and "TURBO: ON" or "TURBO: OFF"
turboToggle.BackgroundColor3 = TURBO_MODE and colorToggleOn or colorToggleOff
turboToggle.TextColor3 = colorText
turboToggle.Font = Enum.Font.GothamBold
turboToggle.TextSize = 12
Instance.new("UICorner", turboToggle)

turboToggle.MouseButton1Click:Connect(function()
    TURBO_MODE = not TURBO_MODE
    turboToggle.Text = TURBO_MODE and "TURBO: ON" or "TURBO: OFF"
    turboToggle.BackgroundColor3 = TURBO_MODE and colorToggleOn or colorToggleOff
end)

local autoLevelBtn = Instance.new("TextButton", mainFrame)
autoLevelBtn.Size = UDim2.new(0.45, -5, 0, 25)
autoLevelBtn.Position = UDim2.new(0.5, 5, 0.86, 0)
autoLevelBtn.Text = "AUTO LEVEL: OFF"
autoLevelBtn.BackgroundColor3 = colorToggleOff
autoLevelBtn.TextColor3 = colorText
autoLevelBtn.Font = Enum.Font.GothamBold
autoLevelBtn.TextSize = 12
Instance.new("UICorner", autoLevelBtn)

autoLevelBtn.MouseButton1Click:Connect(function()
    _G.autoLevel = not _G.autoLevel
    autoLevelBtn.Text = _G.autoLevel and "AUTO LEVEL: ON" or "AUTO LEVEL: OFF"
    autoLevelBtn.BackgroundColor3 = _G.autoLevel and colorToggleOn or colorToggleOff
end)
