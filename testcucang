local function checkRawURL(url)
    local success, response = pcall(function()
        return game:HttpGet(url)
    end)

    -- Kiểm tra sự tồn tại của chuỗi trong phản hồi
    if success and response:find("Tô0 jản c4m th4ý như t01 x1n lỗ1.") then
        return true
    else
        return false
    end
end

-- URL raw chứa đoạn mã dự phòng
local backupURL = "https://raw.githubusercontent.com/Gooduck1/gayhub/main/Amanai"

-- Kiểm tra URL trước khi chạy script chính
if not checkRawURL(backupURL) then
    print("Khong Ki Nang Khong Dung Duoc")
    return
end

-- Các đoạn mã chính
-- Script generated by SimpleSpy - credits to exx#9394
local dungeonTicket = getgenv().Setting["Dungeon Mode"] -- Lấy giá trị từ config
local ticketType = "Tickets" -- Giá trị thay đổi cho vé

if dungeonTicket:find("B") then
    ticketType = "BDTickets"
elseif dungeonTicket:find("A") then
    ticketType = "ADTickets"
elseif dungeonTicket:find("C") then
    ticketType = "CDTickets"
end

local args1 = {
    [1] = "Use Dungeon Ticket",
    [2] = {
        [1] = dungeonTicket,
        [2] = ticketType
    }
}
game:GetService("ReplicatedStorage").NEW37.DUNGEONS.DungeonEvent:FireServer(unpack(args1))

local args2 = {
    [1] = "Start Dungeon"
}
game:GetService("ReplicatedStorage").NEW37.DUNGEONS.DungeonEvent:FireServer(unpack(args2))

-- Kill Aura
getgenv().G = true
getgenv().Creator = ' - HalloweenGaster'
local damageAmount = 2000000000 -- 2 billion damage
local killThreshold = 100 -- adjust this value to change the health threshold for killing

task.spawn(function()
    while getgenv().G and getgenv().Creator == ' - HalloweenGaster' do
        task.wait(1) -- Use task.wait() for better performance
        pcall(function() -- Use pcall to catch errors and avoid crashes
            sethiddenproperty(game.Players.LocalPlayer, "SimulationRadius", math.huge)
            sethiddenproperty(game.Players.LocalPlayer, "MaxSimulationRadius", math.huge)
            
            for _, d in ipairs(game.Workspace:GetDescendants()) do
                if d:IsA('Humanoid') and d.Parent:IsA('Model') and d.Parent.Name ~= game.Players.LocalPlayer.Name then
                    d.Health = d.Health - damageAmount

                    if d.Health <= killThreshold then
                        d.Health = 0
                    end
                end
            end
        end)
    end
end)

-- Farm Beerus
getgenv().Farming = true -- Toggle farming on or off
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local RemoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")
local BladeCombatRemote = RemoteEvents:WaitForChild("BladeCombatRemote")
local YasakaniStringOfJewelsRemote = RemoteEvents:WaitForChild("YasakaniStringOfJewelsRemote")

-- Position and CFrame of the farming spot
local farmingPosition = Vector3.new(-73.9914, 7.93762, 91.7143)
local farmingCFrame = CFrame.new(-73.9914017, 7.93762016, 91.7143021, 0.154201925, 0, -0.988039374, 0, 1, 0, 0.988039374, 0, 0.154201925)

-- Name of the mob and folder
local mobName = "Beerus"
local mobFolder = Workspace:FindFirstChild("Live") -- Adjust if needed

local resetCount = 0 -- Count resets to avoid continuous resets

-- Function to equip the tool
local function equipTool()
    for _, v in next, Player.Backpack:GetChildren() do
        if v:IsA("Tool") and v:FindFirstChild("Combat Script") then
            v.Parent = Player.Character
        end
    end
end

-- Function to perform the attack using remotes
local function attackMob(mob)
    YasakaniStringOfJewelsRemote:FireServer(
        false,
        Vector3.new(mob.HumanoidRootPart.Position),
        CFrame.new(mob.HumanoidRootPart.Position) * CFrame.Angles(-2.0023627281188965, -0.46684175729751587, -2.3676700592041016),
        1,
        Vector3.new(0.4096800982952118, -0.8180325031280518, 0.40371400117874146)
    )
    task.wait(0.05)

    -- BladeCombatRemote using custom args from SimpleSpy
    local args = {
        [1] = false,
        [2] = Vector3.new(-1187.0650634765625, -4516.17529296875, -6797.0947265625),
        [3] = CFrame.new(-1187.0650634765625, -4516.17529296875, -6797.0947265625) * CFrame.Angles(-0.5363068580627441, 0.12107609212398529, 0.07167144119739532)
    }
    BladeCombatRemote:FireServer(unpack(args))
end

-- Function to reset the character
local function resetCharacter()
    Player.Character.Humanoid.Health = 0
    resetCount = resetCount + 1
    print("Character reset count: ", resetCount)
end

task.spawn(function()
    while getgenv().Farming do
        task.wait(0.1) -- Short wait to avoid script overload

        if mobFolder then
            local mob = mobFolder:FindFirstChild(mobName)

            if mob and mob:FindFirstChildOfClass("Humanoid") then
                -- Move player to the farming position
                Player.Character.HumanoidRootPart.CFrame = farmingCFrame

                -- Equip tool
                equipTool()

                -- Deal damage to the mob and use attack remotes
                pcall(function()
                    local humanoid = mob:FindFirstChildOfClass("Humanoid")
                    if humanoid.Health > 0 then
                        attackMob(mob) -- Use remotes to perform attack
                        humanoid:TakeDamage(1) -- Deal damage to trigger mob reset
                    end

                    -- Reset character if health drops and reset count is less than 2
                    if Player.Character.Humanoid.Health < Player.Character.Humanoid.MaxHealth and resetCount < 2 then
                        resetCharacter()
                    elseif resetCount >= 2 then
                        resetCount = 0 -- Reset the counter after two resets
                    end
                end)
            end
        else
            print("Mob folder not found!") -- Debug message if folder is missing
        end
    end
end)

-- Thêm chức năng Black Screen
local function toggleBlackScreen(state)
    if state then
        game:GetService("RunService"):Set3dRenderingEnabled(false)
    else
        game:GetService("RunService"):Set3dRenderingEnabled(true)
    end
end

-- Kích hoạt hoặc tắt Black Screen từ config
toggleBlackScreen(getgenv().Setting["White Screen"])
